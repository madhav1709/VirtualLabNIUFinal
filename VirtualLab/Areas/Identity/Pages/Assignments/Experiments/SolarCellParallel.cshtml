@page
@model SolarCellParallelModel
@{
    ViewData["Title"] = "Solar Cell - Parallel Connection Experiment";
}

@section scripts {
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="~/js/practicalExperiments/solarCellParallel.js"></script>
}
<br>

<link rel="stylesheet" type="text/css" href="~/css/practicalExperiments/solarCellParallel.css">
@{
    if (Model.finalResult == null)
    {
        <h2>Experiment 7 : Solar Cells - Parallel Connection</h2>
        <div class="row">

            <div class="col-md-8">
                <div class="circuit-container js-circuit-container">
                    <span class="solarCellParallel-circuit js-circuit"></span>

                    <span class="solarCellParallel-circuit-connection a js-circuit-connection" id="zva0"></span>
                    <span class="solarCellParallel-circuit-connection b js-circuit-connection" id="zvb0"></span>
                    <span class="solarCellParallel-circuit-connection c js-circuit-connection" id="zvc0"></span>
                    <span class="solarCellParallel-circuit-connection d js-circuit-connection" id="yvd0"></span>
                </div>
            </div>

            <div class="col-md-4">
                <div class="drag-container">
                    <div id="di21" class="drag-item">
                        <p>Solar Panel</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/solarpanel.png" id="avz0" class="img-svg rotateimg90" />
                    </div>
                </div>
                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Solar Panel</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/solarpanel.png" id="bvz0" class="img-svg" />
                    </div>
                </div>

                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Solar Panel</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/solarpanel.png" id="cvz0" class="img-svg rotateimg90" />
                    </div>
                </div>

                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Voltmeter</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/voltmeter.png" id="dvy0" class="img-svg" />
                    </div>
                </div>
            </div>

        </div>
        <br /><br />
        <hr />
        <br /><br />
        <div class="row">

            <div class="col-md-8">
                <div class="circuit-container js-circuit-container">
                    <span class="solarCellParallel-circuit-auto js-circuit"></span>

                    <span class="solarCellParallel-circuit-connection e js-circuit-connection" id="zva1"></span>
                    <span class="solarCellParallel-circuit-connection f js-circuit-connection" id="zvb1"></span>
                    <span class="solarCellParallel-circuit-connection g js-circuit-connection" id="zvc1"></span>
                    <span class="solarCellParallel-circuit-connection h js-circuit-connection" id="yhd1"></span>
                    <span class="solarCellParallel-circuit-connection i js-circuit-connection" id="xve1"></span>
                    <span class="solarCellParallel-circuit-connection j js-circuit-connection" id="wvf1"></span>
                </div>
            </div>

            <div class="col-md-4">
                <div class="drag-container">
                    <div id="di21" class="drag-item">
                        <p>Solar Panel</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/solarpanel.png" id="avz1" class="img-svg rotateimg90" />
                    </div>
                </div>
                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Solar Panel</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/solarpanel.png" id="bvz1" class="img-svg" />
                    </div>
                </div>

                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Solar Panel</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/solarpanel.png" id="cvz1" class="img-svg rotateimg90" />
                    </div>
                </div>

                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Voltmeter</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/voltmeter.png" id="dvw1" class="img-svg" />
                    </div>
                </div>

                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Variable Resistor</p>
                        <img src="~/images/practicalExperiments/solarCellsSeries/Variable_Resistor.svg" id="evx1" class="img-svg rotateimg90" />
                    </div>
                </div>
                <div class="drag-container">
                    <div id="di22" class="drag-item">
                        <p>Ammeter</p>
                        <img src="~/images/practicalExperiments/solarCellsParallel/ammeter.png" id="fhy1" class="img-svg" />
                    </div>
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-md-4">
                <form id="solarCellParallel" method="post">
                    <div class="form-group">
                        <label asp-for="Input.Suns"></label>
                        <input asp-for="Input.Suns" class="form-control" />
                        <span asp-validation-for="Input.Suns" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.TaC"></label>
                        <input asp-for="Input.TaC" class="form-control" />
                        <span asp-validation-for="Input.TaC" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.Ra"></label>
                        <input asp-for="Input.Ra" class="form-control" />
                        <span asp-validation-for="Input.Ra" class="text-danger"></span>
                    </div>
                    <input type="button" class="btn btn-primary" onclick="onBtnClick()" value="Submit">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <a class="btn btn-primary" href="/identity/assignments" role="button">Go Back</a>

                </form>
            </div>
        </div>
    }
    else
    {
        <h2>Experiment 7 : Solar Cells - Parallel Connection Result</h2>
        <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript">
            var dataJSON = "@Model.finalResult";
            //dataJSON = JSON.parse(dataJSON.replace(/&quot;/g, '"'));
            var result = dataJSON.replace(/&#xA;/g, "");
            console.log(result);
            dataJSON = JSON.parse(result.replace(/&quot;/g, '"'));

            if (sessionStorage.getItem("finalVoltageSolarParallel") === null) {
                var FinalVoltage = [];
                var FinalCurrent = [];
                var FinalResistance = [];
            }

            if (sessionStorage.getItem("finalVoltageSolarParallel") !== null) {
                var FinalVoltage = sessionStorage['finalVoltageSolarParallel'].split(",");
                var FinalCurrent = sessionStorage['finalCurrentSolarParallel'].split(",");
                var FinalResistance = sessionStorage['finalResistanceSolarSeries'].split(",");

                sessionStorage.removeItem('finalVoltageSolarParallel');
                sessionStorage.removeItem('finalCurrentSolarParallel');
                sessionStorage.removeItem('finalResistanceSolarSeries');
            }


            var Voltage = dataJSON["V"];
            var Current = dataJSON["I"];

            FinalVoltage.push(Voltage);
            FinalCurrent.push(Current);
            FinalResistance.push(@Model.Input.Ra);

            sessionStorage.setItem('finalVoltageSolarParallel', FinalVoltage);
            sessionStorage.setItem('finalCurrentSolarParallel', FinalCurrent);
            sessionStorage.setItem('finalResistanceSolarSeries', FinalResistance);
            console.log(sessionStorage['finalVoltageSolarParallel']);

            var xMaxRange = parseFloat(FinalVoltage[0]);
            var yMaxRange = parseFloat(FinalCurrent[0]);
            var xMinRange = parseFloat(FinalVoltage[0]);
            var yMinRange = parseFloat(FinalCurrent[0]);

            var dataOne = [
                [{ 'x': parseFloat(FinalVoltage[0]), 'y': parseFloat(FinalCurrent[0]) }]
            ];

            for (var i = 0; i < FinalCurrent.length; i++) {
                if (yMaxRange < parseFloat(FinalCurrent[i])) {
                    yMaxRange = parseFloat(FinalCurrent[i]);
                }
                if (yMinRange > parseFloat(FinalCurrent[i])) {
                    yMinRange = parseFloat(FinalCurrent[i]);
                }

                if (xMaxRange < parseFloat(FinalVoltage[i])) {
                    xMaxRange = parseFloat(FinalVoltage[i]);
                }
                if (xMinRange > parseFloat(FinalVoltage[i])) {
                    xMinRange = parseFloat(FinalVoltage[i]);
                }

                dataOne[0].push({
                    'x': parseFloat(FinalVoltage[i]),
                    'y': parseFloat(FinalCurrent[i])
                });
            }

            console.log(yMaxRange);
            console.log(yMinRange);

            var graphOneXLabel = "Voltage (V)";
            var graphOneYLabel = "Current (A)";

            console.log(dataOne);
        </script>

        <div class="row">
            <div class="col-md-4">
                <form id="solarPanel" method="post">
                    <div class="form-group">
                        <label asp-for="Input.Suns"></label>
                        <input asp-for="Input.Suns" class="form-control" />
                        <span asp-validation-for="Input.Suns" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.TaC"></label>
                        <input asp-for="Input.TaC" class="form-control" />
                        <span asp-validation-for="Input.TaC" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Input.Ra"></label>
                        <input asp-for="Input.Ra" class="form-control" />
                        <span asp-validation-for="Input.Ra" class="text-danger"></span>
                    </div>
                    <input type="submit" class="btn btn-primary" value="Submit">
                </form>
            </div>
            <div class="col-md-6">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Resistance</th>
                            <th scope="col">Open Circuit Voltage</th>
                            <th scope="col">Short Circuit Current</th>
                            <th scope="col">Power</th>
                        </tr>
                    </thead>
                    <tbody id="tablePrint"></tbody>
                </table>
                <script language="javascript" type="text/javascript">
                    var myTable = "";
                    for (var i = 0; i < FinalCurrent.length; i++) {
                        myTable += "<tr><th scope='row'>" + (i + 1) + "</th>";
                        myTable += "<td>" + parseFloat(FinalResistance[i]) + "</td>";
                        myTable += "<td>" + parseFloat(FinalVoltage[i]) + "</td>";
                        myTable += "<td>" + parseFloat(FinalCurrent[i]) + "</td>";
                        myTable += "<td>" + (parseFloat(FinalCurrent[i]) * parseFloat(FinalVoltage[i])) + "</td>";
                        myTable += "</tr>";
                        console.log(FinalCurrent[i]);
                        console.log(FinalVoltage[i]);
                    }

                    document.getElementById('tablePrint').innerHTML = myTable;
                </script>

            </div>
        </div>
        <div class="row" id="graphOne">
            <h3>Graph</h3>
            <script type="text/javascript" src="~/js/graph/graphOne.js"></script>
        </div>
        <div class="row" id="graphTwo">
            <h3>Power Graph</h3>
            <script type="text/javascript">

                var dataTwo = [
                    [{ 'x': parseFloat(FinalVoltage[0]), 'y': (parseFloat(FinalCurrent[0]) * parseFloat(FinalVoltage[0])) }]
                ];

                var x1MaxRange = parseFloat(FinalVoltage[0]);
                var y1MaxRange = (parseFloat(FinalCurrent[0]) * parseFloat(FinalVoltage[0]));
                var x1MinRange = parseFloat(FinalVoltage[0]);
                var y1MinRange = (parseFloat(FinalCurrent[0]) * parseFloat(FinalVoltage[0]));


                for (var i = 0; i < FinalCurrent.length; i++) {
                    if (x1MaxRange < parseFloat(FinalVoltage[i])) {
                        x1MaxRange = parseFloat(FinalVoltage[i]);
                    }
                    if (x1MinRange > parseFloat(FinalVoltage[i])) {
                        x1MinRange = parseFloat(FinalVoltage[i]);
                    }

                    if (y1MaxRange < (parseFloat(FinalCurrent[i]) * parseFloat(FinalVoltage[i]))) {
                        y1MaxRange = (parseFloat(FinalCurrent[i]) * parseFloat(FinalVoltage[i]));
                    }
                    if (y1MinRange > (parseFloat(FinalCurrent[i]) * parseFloat(FinalVoltage[i]))) {
                        y1MinRange = (parseFloat(FinalCurrent[i]) * parseFloat(FinalVoltage[i]));
                    }

                    dataTwo[0].push({
                        'x': parseFloat(FinalVoltage[i]),
                        'y': (parseFloat(FinalCurrent[i]) * parseFloat(FinalVoltage[i]))
                    });
                }

                var graphTwoXLabel = "Voltage";
                var graphTwoYLabel = "Power";

                console.log(dataTwo);
            </script>
            <script type="text/javascript" src="~/js/graph/graphTwo.js"></script>
        </div>

        <div class="row">
            <a class="btn btn-primary" href="/identity/assignments/experiments/solarcellparallel" role="button">Go Back</a>
        </div>
    }
}